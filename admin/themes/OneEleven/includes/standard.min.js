
(function(global,$){'use strict';var OE=global.OE={};$(document).ready(function(){OE.helper.init();OE.view.init();});OE.helper={init:function(){var _this=this;$('a[rel=external]').attr('target','_blank');$('input.defaultfocus:eq(0), input[autofocus]').focus();if(!_this._isLocalStorage()){_this.loadScript('themes/OneEleven/includes/jquery.cookie.min.js');}},loadScript:function(url,arg1,arg2){var cache=true,callback=null,load=true;if($.isFunction(arg1)){callback=arg1;cache=arg2||cache;}else{cache=arg1||cache;callback=arg2||callback;}
$('script[type="text/javascript"]').each(function(){var load=(url!==$(this).attr('src'));return load;});if(load){$.ajax({type:'GET',url:url,async:false,success:callback,dataType:'script',cache:cache});}else{if($.isFunction(callback)){callback.call(this);}}},setStorageValue:function(key,value,expires){var _this=this,expiration=new Date().getTime()+(expires*24*60*60*1000),obj={};try{if(_this._isLocalStorage()===true){localStorage.removeItem(key);if(expires!==null){obj={value:value,timestamp:expiration};}else{obj={value:value,timestamp:''};}
localStorage.setItem(key,JSON.stringify(obj));}else{if(expires!==null){obj={expires:expires};}
if($.fn.cookie!=='undefined'){$.cookie(key,value,obj);}}}catch(error){console.log('localStorage Error: set('+key+', '+value+')');console.log(error);}},getStorageValue:function(key){var _this=this,data='',value;if(_this._isLocalStorage()){data=JSON.parse(localStorage.getItem(key));if(data!==null&&data.timestamp<new Date().getTime()){_this.removeStorageValue(key);}else if(data!==null){value=data.value;}}else{if($.fn.cookie!=='undefined'){value=$.cookie(key);}}
return value;},removeStorageValue:function(key){var _this=this;if(_this._isLocalStorage()){localStorage.removeItem(key);}else{$.cookie(key,null);}},equalHeight:function(obj){var tallest=0,elHeight;obj.each(function(){var el=$(this),elHeight=el.height();if(elHeight>tallest){tallest=elHeight;}});obj.height(tallest);},_isLocalStorage:function(){return typeof(Storage)!=='undefined';},_isMobileDevice:function(){var ua=navigator.userAgent.toLowerCase(),devices=/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i;if(ua.match(devices)&&(('ontouchstart'in window)||(navigator.msMaxTouchPoints>0)||window.DocumentTouch&&document instanceof DocumentTouch)){return true;}}};OE.view={init:function(){var _this=this,$sidebar_toggle=$('.toggle-button'),$container=$('#oe_container'),$menu=$('#oe_pagemenu'),$toggle_dropzone=$('.toggle-dropzone'),$dropzone=$('.pageheader');$('#oe_admin-content').css('min-height',($('#oe_sidebar').height()));$sidebar_toggle.on('click',function(e){e.preventDefault();if($container.hasClass('sidebar-on')){_this._closeSidebar($container,$menu);}else{_this._showSidebar($container,$menu);}});_this.toggleDropzone($toggle_dropzone,$dropzone);_this.toggleSubMenu($menu,50);_this.showNotifications();_this.setUIButtons();_this.updateDisplay();$(window).resize(function(){$('.dashboard-inner').css('height','auto');_this.updateDisplay();});},handleSidebar:function(trigger,container){var viewportWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(OE.helper.getStorageValue('sidebar-pref')==='sidebar-off'&&viewportWidth>768){container.addClass('sidebar-off').removeClass('sidebar-on');trigger.addClass('open-sidebar');}else{container.addClass('sidebar-on').removeClass('sidebar-off');trigger.addClass('close-sidebar');}},stickyMenu:function(obj){var viewportWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,viewportHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,offset=obj.offset(),topOffset=offset.top,leftOffset=offset.left,scrollTop=$(window).scrollTop();$(window).scroll(function(){if(viewportWidth<768){obj.css({marginTop:'45px',position:'relative'});}else if((viewportWidth>=768)&&(viewportHeight>=obj.height())){scrollTop=$(window).scrollTop();if(scrollTop>=topOffset){obj.css({marginTop:'-100px',position:'fixed'});}else if(scrollTop<topOffset){obj.css({marginTop:'45px',position:'relative'});}}});},toggleDropzone:function(trigger,obj){trigger.click(function(e){e.preventDefault();$('.drop-inner').toggleClass('hidden');if($('.drop-inner').hasClass('hidden')){OE.helper.setStorageValue('dropzone-pref','hidden',60);}else{OE.helper.removeStorageValue('dropzone-pref');}});if(OE.helper.getStorageValue('dropzone-pref')==='hidden'){$('.drop-inner').addClass('hidden');}else{$('.drop-inner').removeClass('hidden');}},toggleSubMenu:function(obj,duration){obj.find('li.current span').addClass('open-sub');obj.find('> li > span').click(function(){var ul=$(this).next();if(ul.is(':visible')===false){obj.find('ul').slideUp(duration);}
ul.slideToggle(duration);});},showNotifications:function(){$('.pagewarning, .message, .pageerrorcontainer, .pagemcontainer').prepend('<span class="close-warning"></span>');$(document).on('click','.close-warning',function(){$(this).parent().hide();$(this).parent().remove();});var key=$('body').attr('id')+'_notification';$('.pagewarning .close-warning').click(function(){OE.helper.setStorageValue(key,'hidden',60);});if(OE.helper.getStorageValue(key)==='hidden'){$('.pagewarning').addClass('hidden');}
$('.message:not(.no-slide)').click(function(){$('.message').slideUp();});$('.message:not(.no-slide), .pageerrorcontainer:not(.no-slide), .pagemcontainer:not(.no-slide)').each(function(){var message=$(this);$(message).hide().slideDown(1000,function(){window.setTimeout(function(){message.slideUp();},10000);});});$(document).on('cms_ajax_apply',function(e){$('button[name=cancel], button[name=m1_cancel]').fadeOut();$('button[name=cancel], button[name=m1_cancel]').button('option','label',e.close);$('button[name=cancel], button[name=m1_cancel]').fadeIn();var htmlShow='';if(e.response==='Success'){htmlShow='<aside class="message pagemcontainer" role="status"><span class="close-warning">Close</span><p class="pagemessage">'+e.details+'<\/p><\/aside>';}else{htmlShow='<aside class="message pageerrorcontainer" role="alert"><span class="close-warning">Close</span><ul class="pageerror">';htmlShow+=e.details;htmlShow+='<\/ul><\/aside>';}
$('body').append(htmlShow).slideDown(1000,function(){window.setTimeout(function(){$('.message').slideUp();$('.message').remove();},10000);});$(document).on('click','.close-warning',function(){$('.message').slideUp();$('.message').remove();});});},setUIButtons:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var button=$(this),icon=button.data('uiIcon')||'ui-icon-circle-check',label=button.val(),$btn=$('<button />');if(!button.hasClass('noautobtn')||!button.hasClass('no-ui-btn')){if(button.is('[name*=apply]')){icon=button.data('uiIcon')||'ui-icon-disk';}else if(button.is('[name*=cancel]')){icon=button.data('uiIcon')||'ui-icon-circle-close';}else if(button.is('[name*=resettodefault]')||button.attr('id')==='refresh'){icon=button.data('uiIcon')||'ui-icon-refresh';}}
if(button.is(':button')){label=button.text();}
$(this.attributes).each(function(index,attribute){$btn.attr(attribute.name,attribute.value);});$btn.button({icons:{primary:icon},label:label});button.replaceWith($btn);});$('a.pageback').addClass('ui-state-default ui-corner-all').prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});},updateDisplay:function(){var _this=this,viewportWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,$sidebar_toggle=$('.toggle-button'),$container=$('#oe_container'),$menu_container=$('#oe_menu'),$group=$('.dashboard-inner');_this.handleSidebar($sidebar_toggle,$container);OE.helper.equalHeight($group);if(!OE.helper._isMobileDevice()){_this.stickyMenu($menu_container);}},_showSidebar:function(obj,target){obj.addClass('sidebar-on').removeClass('sidebar-off');target.find('li.current ul').show();OE.helper.setStorageValue('sidebar-pref','sidebar-on',60);},_closeSidebar:function(obj,target){obj.removeClass('sidebar-on').addClass('sidebar-off');target.find('li ul').hide();OE.helper.setStorageValue('sidebar-pref','sidebar-off',60);},};})(this,jQuery);